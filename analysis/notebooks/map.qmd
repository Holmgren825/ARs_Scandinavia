---
jupyter:
  jupytext:
    text_representation:
      extension: .qmd
      format_name: quarto
      format_version: '1.0'
      jupytext_version: 1.16.4
  kernelspec:
    display_name: ar_ident
    language: python
    name: ar_ident
---

```{python}
from pathlib import Path

import cartopy.crs as ccrs
import geopandas as gpd
import ultraplot as plt
```

```{python}
gdf = gpd.read_file("../etc/ne_50_admin_0_countries/ne_50m_admin_0_countries.shp")
scand_gdf = gdf[
    (gdf["ADMIN"] == "Sweden")
    + (gdf["ADMIN"] == "Norway")
    + (gdf["ADMIN"] == "Denmark")
]
scand_gdf.loc[scand_gdf.index == 88, "geometry"] = (
    scand_gdf.loc[scand_gdf.index == 88, "geometry"].iloc[0].geoms[0]
)
```

```{python}
LAT_SLICE = (54, 71)
LON_SLICE = (-5, 40)
```

```{python}
from shapely.ops import unary_union
```

```{python}
shape = unary_union(scand_gdf.geometry)
```

```{python}
smoothing = 0.85
un_smoothing = -0.15
join_style = "round"  # round, mitre, bevel

fig, ax = plt.subplots(
    figwidth="8.5cm",
    proj="lcc",
    proj_kw={"central_longitude": 15},
)
# gpd.GeoSeries(
#     shape
# ).boundary.plot(ax=ax, color="C1", zorder=5, lw=1, transform=ccrs.PlateCarree(), label="Scandinavia")

gpd.GeoSeries(
    shape.buffer(smoothing, join_style=join_style).buffer(
        un_smoothing, join_style=join_style
    )
).boundary.plot(
    ax=ax, color="C1", zorder=5, transform=ccrs.PlateCarree(), label="Smoothed region"
)


ax.annotate(
    "Sweden",
    (13, 62),
    weight="bold",
    rotation=45,
    xycoords="data",
    transform=ccrs.PlateCarree(),
)
ax.annotate(
    "Norway",
    (6.5, 59),
    weight="bold",
    rotation=45,
    xycoords="data",
    transform=ccrs.PlateCarree(),
)
ax.annotate(
    "Finland",
    (23, 62),
    weight="bold",
    rotation=10,
    xycoords="data",
    transform=ccrs.PlateCarree(),
)
arrowprops = {"arrowstyle": "simple", "fc": "k", "ec": "white", "lw": 0.3}
bbox = {"facecolor": "white", "alpha": 0.8}

color = "blue9"

ax.annotate(
    "Denmark",
    (10, 56),
    weight="bold",
    rotation=0,
    xytext=(-1, 54),
    xycoords="data",
    transform=ccrs.PlateCarree(),
    arrowprops=arrowprops,
    zorder=5,
    bbox=bbox,
)

ax.annotate(
    "Skagerrak Strait",
    (10, 58.5),
    rotation=0,
    color=color,
    #weight="bold",
    xytext=(19, 54),
    xycoords="data",
    transform=ccrs.PlateCarree(),
    arrowprops=arrowprops,
    zorder=5,
    bbox=bbox,
)

ax.annotate(
    "Baltic Sea",
    (20, 59),
    rotation=0,
    color=color,
    #weight="bold",
    xytext=(24.5, 57.5),
    xycoords="data",
    transform=ccrs.PlateCarree(),
    arrowprops=arrowprops,
    zorder=5,
    bbox=bbox,
)

ax.annotate(
    "North Sea",
    (2, 57.5),
    rotation=0,
    color=color,
    #weight="bold",
    xytext=(-6, 62),
    xycoords="data",
    transform=ccrs.PlateCarree(),
    arrowprops=arrowprops,
    zorder=5,
    bbox=bbox,
)

ax.annotate(
    "Norwegian Sea",
    (8, 66),
    rotation=0,
    color=color,
    #weight="bold",
    xytext=(-5, 68),
    xycoords="data",
    transform=ccrs.PlateCarree(),
    arrowprops=arrowprops,
    zorder=5,
    bbox=bbox,
)

ax.legend(loc="ul", ncols=1)
ax.format(
    suptitle="Scandinavia and smoothed study region",
    coast=True,
    reso="hi",
    land=True,
    borders=True,
    landcolor="bisque",
    facecolor="blue2",
    latlabels=True,
    lonlabels=True,
    lonlim=(-4, 32),
    latlim=(52, 72),
    title="",
)
```

```{python}
fig.savefig("../../figures/scandi_map.svg")
```
